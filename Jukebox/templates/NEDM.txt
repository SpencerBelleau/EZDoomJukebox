#library "NEDM"
#include "zcommon.acs"

<<MUSICSTRINGS>>
<<MUSICNAMES>>
<<MUSICLENGTHS>>
int tracks = <<NUMTRACKS>>;

script "NEDM" OPEN
{
	int tracknum = -1;
	int oldtrackNum = 0;
	int delaytimer = 1; //let's do a tiny bit more error checking
	while(1)
	{
		//Patented retard logic to avoid replays
		if(tracknum == -1 && tracks > 1)
		{
			tracknum = random(0, tracks - 1);
		}
		else if(tracks > 1)
		{
			oldtrackNum = tracknum;
			while(tracknum == oldtrackNum)
			{
				tracknum = random(0, tracks - 1);
			}
		}
		else
		{
			//you only got one song son wtf
			tracknum = 0;
		}
		if(GetCVar("ezjb_showOnscreenMessages") == 1)
		{
			SetFont("SMALLFONT");
			//improve this later, maybe with more templating
			HudMessage(	s:"\cqNOW PLAYING: \cd", s:songRealNames[tracknum];
						HUDMSG_PLAIN, 
						3485, //random to avoid collision
						CR_UNTRANSLATED,
						0.5,
						0.0,
						GetCVar("ezjb_textHoldTime") << 16); //pls work?
		}
		SetMusic(songNames[tracknum], 0);
		delaytimer = durations[tracknum];
		if(delaytimer == 0)
			delaytimer = 1;
		delay(delaytimer);
	}
}